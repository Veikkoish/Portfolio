---
import Layout from '../layouts/Layout.astro';
import FilterButton from '../components/FilterButton.astro';
import ProjectCard from '../components/ProjectCard.astro';
import { projects, publicPath } from '../config/projects';
---

<Layout title="Portfolio">
  <main class="container mx-auto px-4 md:px-8">
    <!-- Landing Section -->
    <section class="min-h-[70vh] md:h-[70vh] flex items-center justify-center pt-12 md:pt-16 pb-8 md:pb-0">
      <div class="flex flex-col md:flex-row items-center gap-8 md:gap-12 max-w-5xl w-full">
        <div class="w-40 md:w-1/3 flex-shrink-0">
          <img
            src={publicPath('headshot.webp')}
            alt="Headshot"
            class="rounded-full w-full shadow-2xl"
          />
        </div>
        <div class="w-full md:w-2/3 space-y-4 md:space-y-6 md:pl-4 text-center md:text-left">
          <h1
            class="text-4xl md:text-6xl font-bold"
            style="font-family: 'Faculty Glyphic', sans-serif;"
          >
            Veikko Kurki
          </h1>
          <p class="text-base md:text-xl leading-relaxed text-gray-300 md:text-justify">
            I design and build products across disciplines. Whether it's designing circuits, 
            writing code, or engineering mechanical systems, I've spent ten years learning how things work and how to build them better.
            Explore my most relevant projects below.
          </p>
          <p class="text-base md:text-lg" style="color: #a855f7; font-family: 'Faculty Glyphic', sans-serif;">
            New York University, BSc. Computer Science
          </p>
          <div class="flex justify-center md:justify-start gap-4 text-base md:text-lg text-gray-400">
            <a href="mailto:vk2234@nyu.edu" class="hover:text-gray-300 transition-colors">
              vk2234@nyu.edu
            </a>
            <span>â€¢</span>
            <a href="https://www.linkedin.com/in/veikko-kurki-041b3b222/" target="_blank" rel="noopener noreferrer" class="hover:text-gray-300 transition-colors">
              LinkedIn
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Projects Section -->
    <section class="pt-4 pb-20">
      <div class="grid grid-cols-2 md:flex md:flex-wrap justify-center gap-2 md:gap-4 mb-8 md:mb-16 px-2 max-w-xs md:max-w-none mx-auto">
        <FilterButton category="all" label="All" />
        <FilterButton category="hardware" label="Hardware" />
        <FilterButton category="software" label="Software" />
        <FilterButton category="mechanical" label="Mechanical" />
      </div>

      <div id="projects-container">
        {
          projects.map((project) => (
                <ProjectCard
                  title={project.title}
                  description={project.description}
                  image={project.image}
                  category={project.category}
                  skills={project.skills}
                  projectType={project.projectType}
                  year={project.year}
                  video={project.video}
                  inProgress={project.inProgress}
                  slug={project.slug}
                />
          ))
        }
      </div>
    </section>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Filter functionality
      const filterButtons = document.querySelectorAll('.filter-btn');
      const projectCards = document.querySelectorAll('.project-card');
      const container = document.getElementById('projects-container');

      // Set 'All' as active by default
      const allButton = document.querySelector('[data-category="all"]');
      allButton?.classList.add('active');

      filterButtons.forEach((button) => {
        button.addEventListener('click', () => {
          const category = button.getAttribute('data-category');

          // Update active state
          filterButtons.forEach((btn) => btn.classList.remove('active'));
          button.classList.add('active');

          // Create array of cards with their match counts
          const cardsArray = Array.from(projectCards).map((card) => {
            const categories = card.getAttribute('data-categories')?.split(',') || [];
            const skillCategories = card.getAttribute('data-skill-categories')?.split(',') || [];
            
            // Count how many skills match this category
            const matchCount = category === 'all' ? 0 : skillCategories.filter(s => s === category).length;
            
            return {
              element: card,
              categories,
              matchCount,
              shouldShow: category === 'all' || categories.includes(category)
            };
          });

          // Sort by match count (descending) - only matters for non-"all" filters
          cardsArray.sort((a, b) => b.matchCount - a.matchCount);

          // Re-append cards in sorted order and show/hide
          cardsArray.forEach(({ element, shouldShow }) => {
            if (shouldShow) {
              element.classList.remove('hidden');
              container?.appendChild(element);
            } else {
              element.classList.add('hidden');
            }
          });
        });
      });

      // Scroll to project card if hash is present
      const hash = window.location.hash.substring(1);
      if (hash) {
        setTimeout(() => {
          const targetCard = document.getElementById(hash);
          targetCard?.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
      }
    });
  </script>
</Layout>
